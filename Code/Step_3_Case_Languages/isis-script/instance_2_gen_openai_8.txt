## Differences between Grammar 1 and Grammar 2 (what impacts the instance)

1. **`IsisEntity` body contents changed**
   - **Removed** from entity body: `events+=IsisEvent`, `repositories+=IsisRepository`
   - **Added** to entity body: `collections+=IsisCollection`
   - Still allowed: `injections`, `properties`, `actions`, `uiHints`

2. **`IsisProperty` inner block changed**
   - Grammar 1: `{ features+=IsisPropertyFeature* }`
   - Grammar 2: `{ (features+=IsisPropertyFeature | events+=IsisEvent)* }`
   - Also, **`IsisPropertyFeature` now supports annotations** (optional, so we won’t add any).
   - This change is optional unless you had property blocks; Instance 1 has no property `{...}` block, so no required change here.

3. **Property feature enum changed**
   - Grammar 2 adds `Complete='complete'` and reorders entries (reordering doesn’t matter).
   - Optional additions; we will not instantiate.

4. **New `IsisCollection` concept introduced**
   - Entities/services can now contain `collection ...` declarations.
   - Optional; we will not add any.

5. **`IsisAction` syntax changed (major)**
   - Grammar 1 action:
     ```
     action (returnType)? name '(' params? ')' expression=XBlockExpression
     ```
   - Grammar 2 action:
     ```
     action type=JvmTypeReference name=ID '{'
        (features | parameters | events)*
     '}'
     ```
   - So:
     - Parenthesized parameter list is gone.
     - Action body is now a block with entries like `parameter ...` and `body { ... }` (plus optional other features/events).
     - The return type is now **required** as `type` after `action`.

6. **Action parameters changed**
   - Grammar 1: parameters are in `(...)` and are `FullJvmFormalParameter` with optional annotations.
   - Grammar 2: parameters are declared inside the action block using the keyword **`parameter`**:
     ```
     parameter <FullJvmFormalParameter> ( '{' features* '}' )?
     ```
   - Parameter features exist but are optional; we won’t add them.

7. **Repositories removed**
   - Grammar 1 supported `repository { ... }` blocks inside an entity.
   - Grammar 2 has **no `IsisRepository` rule**, so the entire repository section in Instance 1 must be removed or moved elsewhere (but Grammar 2 also doesn’t introduce an equivalent, so it must be removed).

8. **Events placement**
   - Grammar 1 allowed `event` directly in the entity body.
   - Grammar 2 allows `event` only **inside** `property {}`, `collection {}`, `action {}`.
   - So the top-level `event UpdateNameDomainEvent` must be removed or relocated. Since adding optional blocks just to hold it would be instantiation of optional constructs not required by migration, it will be removed.

9. **UI hints unchanged**
   - `title { ... }` remains valid as `IsisUiHint`.

---

## Instance 2 (migrated to Grammar 2)

```xtend
package domainapp.dom.modules.simple

import javax.jdo.annotations.Column
import javax.jdo.annotations.DatastoreIdentity
import javax.jdo.annotations.IdGeneratorStrategy
import javax.jdo.annotations.IdentityType
import javax.jdo.annotations.PersistenceCapable
import javax.jdo.annotations.Queries
import javax.jdo.annotations.Query
import javax.jdo.annotations.Unique
import javax.jdo.annotations.Version
import javax.jdo.annotations.VersionStrategy
import org.apache.isis.applib.annotation.Action
import org.apache.isis.applib.annotation.ActionLayout
import org.apache.isis.applib.annotation.BookmarkPolicy
import org.apache.isis.applib.annotation.DomainObject
import org.apache.isis.applib.annotation.DomainObjectLayout
import org.apache.isis.applib.annotation.DomainServiceLayout
import org.apache.isis.applib.annotation.Editing
import org.apache.isis.applib.annotation.MemberOrder
import org.apache.isis.applib.annotation.Parameter
import org.apache.isis.applib.annotation.ParameterLayout
import org.apache.isis.applib.annotation.Property
import org.apache.isis.applib.annotation.SemanticsOf
import org.apache.isis.applib.annotation.Title
import org.apache.isis.applib.query.QueryDefault
import org.apache.isis.applib.services.i18n.TranslatableString

@PersistenceCapable(identityType=IdentityType.DATASTORE)
@DatastoreIdentity(strategy=IdGeneratorStrategy.IDENTITY, column="id")
@Version(strategy=VersionStrategy.VERSION_NUMBER, column="version")
@Queries(#[
	@Query(name = "find", language = "JDOQL",
		value = "SELECT FROM domainapp.dom.modules.simple.SimpleObject"),
	@Query(name = "findByName", language = "JDOQL",
		value = "SELECT FROM domainapp.dom.modules.simple.SimpleObject WHERE name.indexOf(:name) >= 0")
])
@Unique(name="SimpleObject_name_UNQ", members = #["name"])
@DomainObject(objectType = "SIMPLE")
@DomainObjectLayout(bookmarking = BookmarkPolicy.AS_ROOT)
entity SimpleObject {

	@Column(allowsNull="false", length = 40)
	@Title(sequence="1")
	@Property(editing = Editing.DISABLED)
	property String name

	@Action(domainEvent = UpdateNameDomainEvent)
	action SimpleObject updateName {
		parameter @Parameter(maxLength = 40)
            @ParameterLayout(named = "New name") String newName
		body {
			setName(newName)
			this
		}
	}

	action String default0UpdateName {
		body {
			getName()
		}
	}

    	action Object validateUpdateName {
		parameter String name
		body {
	        	if (name.contains("!"))
	        		TranslatableString.tr("Exclamation mark is not allowed")
	        	else null
		}
    	}

	title {
		TranslatableString.tr("Object: {name}", "name", name)
	}

}
```

Notes on required edits applied:
- Removed `event UpdateNameDomainEvent` (no longer allowed at entity top-level in Grammar 2).
- Removed the entire `repository { ... }` block (rule removed in Grammar 2).
- Converted each `action ...(...) { ... }` into Grammar 2’s `action <type> <name> { ... }` form:
  - Parameters moved into `parameter ...` entries inside the action block.
  - The executable code moved into an `IsisActionFeature` of type `body` as `body { ... }`.
- Did **not** add any new optional constructs (collections, events inside actions, parameter feature blocks, etc.), except what’s necessary to make actions syntactically valid under Grammar 2 (i.e., `body { ... }` and `parameter ...`).