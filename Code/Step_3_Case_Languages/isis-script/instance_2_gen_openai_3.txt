## Differences (Grammar 1 → Grammar 2)

1. **Top-level members inside `entity` / `service`**
   - **Removed from `IsisEntity`:** `events+=IsisEvent`, `repositories+=IsisRepository`
   - **Added to `IsisEntity`:** `collections+=IsisCollection`
   - **Changed `IsisService`:** now allows `(collections+=IsisCollection | actions+=IsisAction)` in addition to injections.
   - Implication for `instance_1`: the standalone line `event UpdateNameDomainEvent` is no longer allowed at entity top-level; and the `repository { ... }` block is no longer part of the grammar at all.

2. **`IsisProperty` block contents**
   - Grammar 1: `{ features+=IsisPropertyFeature* }`
   - Grammar 2: `{ (features+=IsisPropertyFeature | events+=IsisEvent)* }`
   - Also `IsisPropertyFeature` now allows annotations (new optional), but per your rule (2) we must not instantiate newly-added optional/OR content unless required.

3. **Property feature enum extended/reordered**
   - Grammar 2 adds `Complete='complete'` and reorders the literals; existing ones remain.
   - No required change unless an instance uses these features (it doesn’t).

4. **`IsisAction` radically restructured**
   - Grammar 1: `action` with optional return type, name, `(` parameters `)` and then `expression` block.
   - Grammar 2: `action` requires a `type=JvmTypeReference` and uses a **curly-brace body** with mixed contents:
     - `(features+=IsisActionFeature | parameters+=IsisActionParameter | events+=IsisEvent)*`
     - Actual executable body is now an **action feature**: `body { ... }` (since `IsisActionFeatureType` includes `Body='body'`).
   - Implication: every `action ... ( ... ) { ... }` must become `action <Type> <name> { ... }` and parameters move into `parameter ...` entries, while the former body goes inside `body { ... }`.

5. **`IsisActionParameter` changed**
   - Grammar 1: inline in the action parentheses as `type=FullJvmFormalParameter` (with optional annotations).
   - Grammar 2: explicit parameter blocks: `parameter <FullJvmFormalParameter> { ... }?` with optional parameter-features.
   - Implication: parameters must be rewritten to `parameter ...` lines within the action block. Any parameter annotations (like `@Parameter`, `@ParameterLayout`) are still allowed (they were already allowed), so we keep them.

6. **Collections added (new rule)**
   - New: `collection ... = <expr> { ... }?`
   - Per your rule (2), we do not introduce any collections.

7. **Repository rule removed**
   - `IsisRepository` does not exist in Grammar 2, so the entire `repository { ... }` portion must be removed (there is no alternative construct in Grammar 2 to host it).

---

## Instance 2 (conforms to Grammar 2)

```xtend
package domainapp.dom.modules.simple

import javax.jdo.annotations.Column
import javax.jdo.annotations.DatastoreIdentity
import javax.jdo.annotations.IdGeneratorStrategy
import javax.jdo.annotations.IdentityType
import javax.jdo.annotations.PersistenceCapable
import javax.jdo.annotations.Queries
import javax.jdo.annotations.Query
import javax.jdo.annotations.Unique
import javax.jdo.annotations.Version
import javax.jdo.annotations.VersionStrategy
import org.apache.isis.applib.annotation.Action
import org.apache.isis.applib.annotation.ActionLayout
import org.apache.isis.applib.annotation.BookmarkPolicy
import org.apache.isis.applib.annotation.DomainObject
import org.apache.isis.applib.annotation.DomainObjectLayout
import org.apache.isis.applib.annotation.DomainServiceLayout
import org.apache.isis.applib.annotation.Editing
import org.apache.isis.applib.annotation.MemberOrder
import org.apache.isis.applib.annotation.Parameter
import org.apache.isis.applib.annotation.ParameterLayout
import org.apache.isis.applib.annotation.Property
import org.apache.isis.applib.annotation.SemanticsOf
import org.apache.isis.applib.annotation.Title
import org.apache.isis.applib.query.QueryDefault
import org.apache.isis.applib.services.i18n.TranslatableString

@PersistenceCapable(identityType=IdentityType.DATASTORE)
@DatastoreIdentity(strategy=IdGeneratorStrategy.IDENTITY, column="id")
@Version(strategy=VersionStrategy.VERSION_NUMBER, column="version")
@Queries(#[
	@Query(name = "find", language = "JDOQL",
		value = "SELECT FROM domainapp.dom.modules.simple.SimpleObject"),
	@Query(name = "findByName", language = "JDOQL",
		value = "SELECT FROM domainapp.dom.modules.simple.SimpleObject WHERE name.indexOf(:name) >= 0")
])
@Unique(name="SimpleObject_name_UNQ", members = #["name"])
@DomainObject(objectType = "SIMPLE")
@DomainObjectLayout(bookmarking = BookmarkPolicy.AS_ROOT)
entity SimpleObject {

	@Column(allowsNull="false", length = 40)
	@Title(sequence="1")
	@Property(editing = Editing.DISABLED)
	property String name

	@Action(domainEvent = UpdateNameDomainEvent)
	action SimpleObject updateName {
		parameter @Parameter(maxLength = 40)
            @ParameterLayout(named = "New name") String newName
		body {
			setName(newName)
			this
		}
	}

	action String default0UpdateName {
		body {
			getName()
		}
	}

    	action String validateUpdateName {
		parameter String name
		body {
	        	if (name.contains("!"))
	        		TranslatableString.tr("Exclamation mark is not allowed")
	        	else null
		}
    	}

	title {
		TranslatableString.tr("Object: {name}", "name", name)
	}

}
```

Key applied transformations:
- Removed the top-level `event UpdateNameDomainEvent` (no longer permitted at entity level).
- Removed the entire `repository { ... }` block (rule removed in Grammar 2).
- Rewrote each `action` to Grammar 2 form:
  - `action <Type> <name> { ... }`
  - moved parameters into `parameter ...`
  - wrapped former action body in `body { ... }`